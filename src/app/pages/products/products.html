<h1 class="text-4xl text-muted-color-emphasis text-center mb-5 underline">Products</h1>

<div class="flex gap-5 items-center justify-between mb-4 text-xl">
  <p-button
    routerLink="/products/add"
    label="Add Product"
    severity="primary" [raised]="true"
  />

  <div>
    <input #inp type="text" pInputText variant="filled" class="w-100" placeholder="Search By Name" />
    <p-button (onClick)="searchByName(inp.value)" label="Search" severity="help" [raised]="true" class="ml-2" />
  </div>

  <p-select #selectInp (onChange)="sortProducts(selectInp.value)" (onClear)="clearSortProducts()" [options]="sortSelectOptions" [showClear]="true" optionValue="value" optionLabel="name" placeholder="Sorting Products" variant="filled" class="w-full md:w-56" />

  <div>
    <p class="text-center">
      page <span class="font-bold text-primary">{{pageNumber()}}</span>
      of <span class="font-bold text-primary">{{totalPages()}}</span> pages
    </p>
    <p>
      Total Products = <span class="font-bold text-primary">{{totalProducts()}}</span>
    </p>
  </div>
</div>

@if(products().length > 0)
{
<p-table [value]="products()" showGridlines stripedRows [tableStyle]="{ 'min-width': '40rem' }">
  <ng-template #header>
    <tr>
      <th>Id</th>
      <th>Name</th>
      <th>Price</th>
      <th>Quantity</th>
      <th>Rating</th>
      <th>Image</th>
      <th>Category</th>
      <th></th>
    </tr>
  </ng-template>
  <ng-template #body let-product>
    <tr>
      <td>{{ product.id }}</td>
      <td class="font-semibold text-primary">{{ product.name }}</td>
      <td class="text-yellow-600 font-bold">{{ product.price | currency }}</td>
      <td>{{ product.quantity }}</td>
      <td>
        <div class="flex flex-col items-center">
          <span class="block text-center">{{product.rating}}</span>
          <p-rating [(ngModel)]="product.rating" [disabled]="true" />
        </div>
      </td>
      <td><img [src]="product.imageUrl" width="75" [alt]="product.name"></td>
      <td>{{ product.category.name }}</td>
      <td>
        <p-button
          label="Delete" styleClass="mr-2"
          severity="danger" [rounded]="true"
          (onClick)="deleteProduct(product.id)"
        />
        <p-button
          [routerLink]="['/products/edit', product.id]"
          severity="info" [rounded]="true" label="Edit" styleClass="mr-2"
        />
        <p-button
          [routerLink]="['/products/details', product.id]"
          severity="contrast" [rounded]="true" label="Details"
        />
      </td>
    </tr>
  </ng-template>
</p-table>
<nav class="flex justify-center mt-4">
<p-buttongroup>
  <p-button (onClick)="getPreviousPage()" [disabled]="pageNumber() <= 1" label="Previous" severity="secondary" [raised]="true" />
  @for (pageNumber of pagesArray(); track $index) {
    <p-button (onClick)="getSelectedPage(pageNumber)" [label]="pageNumber.toString()" severity="warn" [outlined]="pageNumber != this.pageNumber()"  />
  }
  <p-button (onClick)="getNextPage()" [disabled]="this.pageNumber() == this.totalPages()" label="Next" severity="secondary" [raised]="true" />
</p-buttongroup>
</nav>
}
@else {
<p class="text-center text-muted-color-emphasis">No products available.</p>
}

<p-toast />
